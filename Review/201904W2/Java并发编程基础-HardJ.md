## 并发编程基础

**原文地址：https://www.callicoder.com/java-concurrency-multithreading-basics/**

**原文作者：Rajeev Kumar Singh **

并发是指在同一时间做超过一件事情的能力。

早期，计算机只能执行一个程序每次。但是现在，现代计算机同时运行大量的任务。

例如 :

 - 你能同时在你的浏览器上浏览博客，在音乐播放器上听着歌。
 - 你能在文字处理器上编辑文档，同时从因特网上下载文件。

并发并不一定涉及到多个程序。一个正在执行的单体应用中的多个部分也称为并发。

例如：

- 一个文字处理器在格式化文本的同时响应着键盘事件。
- 一个音频流媒体应用从网络上下载文件的同时解析并及时展示到屏幕上。
- 一个web服务器，本质上是跑在计算机上的一个程序但却同时处理着来自世界各地的请求。


#### 并发相关原理

对于一次做超过多件事的软件称为并发软件。

如今，计算机已都是多核处理器。但是在早期单核处理器的计算机中依然拥有并发能力，因为同时在运行的程序数目远超过多核处理器的数目。

实际上，并发执行并不意味着在相同的物理机上同时执行。当我们说:"多个任务在同一时刻执行"意思是"多个任务在同一时间段内执行了"。

任务执行是一个交叉的方式。操作系统在频繁的切换任务使得出现在用户面前的是同一时刻执行多个任务。

因此，并发并非并行。真正的并发不会出现在单核的处理器上。

#### 并发相关单位

并发是一个非常广泛的术语，常被用在不同的层面上。

- 在多处理器中，并发的单位是CPU。
- 在多个任务中，一个单核CPU并发运行着多个任务或进程。在这种情况下，操作系统任务切换速度非常快。并发的单位是一个进程。
- 在多线程中，一个进程的多个部分同时运行。在这种情况下，我们进一步将同一个进行划分为多个线程。并发的单位是一个线程。

#### 进程和线程

##### 	进程

​	一个进程相当于一个程序执行。它有自己的地址空间，调用堆栈，并可以链接任何资源，例如：打开一个文件。

​	一个计算机系统通常会同时运行多个进程，操作系统通过共享CPU执行时间来促进它们执行。

##### 	线程

​	一个线程是进程里的一个执行路径。每一个进程至少都有一个主线程。主线程能够在这个进程内创建额外的线程。这些线程共享着同一进程资源，包括内存和文件描述符。每个线程有它自己的调用栈。由于一个进程内的所有线程共享着进程的地址空间，所以创建线程与线程之间的通信变得更加高效。

#### 并发存在着哪些问题

​	并发通过提升CPU的利用率来尽可能的提升计算机的吞吐量，但也带来了一些问题。

##### 	竞态条件

​	当多个线程尝试并发的读或写共享变量时，这些读和写操作可能重叠。在这种情况下，执行的最终结果是不可预测的，依赖于这些读和写操作的执行顺序。这类错误通常难以预测和修复。

​	通过确保同一时刻仅有一个线程对共享变量进行操作可以避免这个错误。一般的做法是通过互斥锁来访问共享资源。

​	而在每次访问共享变量前都获取一把互斥锁可能导致其他问题，如：死锁问题、饥饿问题。

##### 	缓存一致性

​	缓存一致性问题发生在，对于相同的共享变量，不同的线程拥有不同的缓存。当一个线程更新了共享变量的值后，没有及时通知另一个线程，导致其他线程仍然在使用之前读取到本地缓存中的值。